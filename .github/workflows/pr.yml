name: PR Validation

on:
  pull_request:
    branches:
      - main
    paths-ignore:
      - '**.md'
      - 'docs/**'
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  # Regression check runs FIRST - fast gating check (~2 min)
  # If libvscode-diff has no changes, this skips and passes immediately
  # If there are changes and regression detected, pipeline fails here
  regression-check:
    uses: ./.github/workflows/regression-check.yml
  
  # Standalone build test - validates build.sh/build.cmd work on all platforms
  # Runs in parallel with regression-check (no dependency)
  standalone-build-test:
    uses: ./.github/workflows/standalone-build-test.yml
  
  # Build and test runs ONLY IF regression check passes
  # This prevents wasting CI resources on builds that will fail PR anyway
  build-and-test:
    needs: regression-check
    uses: ./.github/workflows/build-and-test.yml
